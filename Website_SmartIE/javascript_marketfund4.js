// Midterm 4 Questions Array
const midterm4Questions = [
    {
        question: "Which of the following correctly lists marketing intermediaries?",
        options: [
            "Resellers, physical distribution firms, marketing services agencies, and financial intermediaries",
            "Resellers, physical distribution firms, customer markets, and competitors",
            "Resellers, physical distribution firms, marketing services agencies, and customer markets",
            "The company itself, competitors, suppliers, and customer markets",
            "Suppliers, competitors, resellers, and publics"
        ],
        correct: "Resellers, physical distribution firms, marketing services agencies, and financial intermediaries"
    },
    {
        question: "What is the best example of indirect CUSTOMERS of a company?",
        options: [
            "For delivery services, Amazon which contracts them to deliver parcels to Amazon customers",
            "For a cereal company, a child asking the mother to buy a certain brand of cereal",
            "For Uber drivers, Uber users who find and use their service through Uber app",
            "For a microchip producer, the end-users who choose laptops but not microchips inside",
            "For a retail shop, a neighboring shop that offers cheaper products"
        ],
        correct: "For a microchip producer, the end-users who choose laptops but not microchips inside"
    },
    {
        question: "Stripe is a financial tech company that provides easy payment solutions for small businesses wanting to do business online. In SWOT analysis for Stripe, (1) economic downturn and consumers not buying is a(n) ________, and Stripe having a hard-to-imitate encryption technology is a(n) ________.",
        options: [
            "Opportunity; weakness",
            "Opportunity; strength",
            "Weakness; threat",
            "Threat; opportunity",
            "Threat; strength"
        ],
        correct: "Threat; strength"
    },
    {
        question: "In the product/market expansion grid, which one best describes the market penetration strategy?",
        options: [
            "Company growth by starting/acquiring business outside the company's products and markets",
            "Company growth by identifying new markets for existing products",
            "Company growth by increasing sales of current products",
            "Company growth by offering new products to current market segments"
        ],
        correct: "Company growth by increasing sales of current products"
    },
    {
        question: "Which is NOT part of the MACRO-environment of a company?",
        options: [
            "Economic cycle",
            "Technological environments",
            "Competitive situation",
            "Political atmosphere",
            "Social context"
        ],
        correct: "Competitive situation"
    },
    {
        question: "What is true about the development of customer concepts?",
        options: [
            "Mass marketing is the best method for promoting customer loyalty.",
            "Direct marketing was invented to increase customer satisfaction.",
            "Segmenting the market is a practice enabled by Internet technology.",
            "The customer concept development was propelled by increased competition in the marketplace.",
            "The main driver of the development of the customer concept is the selling-oriented view of the companies."
        ],
        correct: "The customer concept development was propelled by increased competition in the marketplace."
    },
    {
        question: "What is the best description of the concept of \"future customers\"?",
        options: [
            "Anyone who hasn't bought our product yet",
            "Non-clients who are more likely to use our goods/services than our competitors' goods/services",
            "Current customers who will keep on buying in the future",
            "Those who will join the workforce and start earning money soon",
            "Those who create good word-of-mouth for our brand"
        ],
        correct: "Non-clients who are more likely to use our goods/services than our competitors' goods/services"
    },
    {
        question: "What is NOT included in typical definitions of marketing?",
        options: [
            "Value",
            "Relationship",
            "Customer",
            "Competitor",
            "Process"
        ],
        correct: "Competitor"
    },
    {
        question: "The primary goal of consistently delivering superior value is to ________.",
        options: [
            "Maximize profits",
            "Avoid the need to advertise",
            "Build profitable customer relationships",
            "Expand into global markets",
            "Keep costs down"
        ],
        correct: "Build profitable customer relationships"
    },
    {
        question: "What is the industry condition in which you can expect stronger future competition (high threat of future entrants)?",
        options: [
            "Where there is a high margin",
            "Where companies invest heavily in R&D",
            "When there is a strong economy of scale",
            "In a mature market",
            "When the incumbent firms have high brand loyalty"
        ],
        correct: "Where there is a high margin"
    },
    {
        question: "Which of the following uses a sense-and-respond philosophy to promote a customer-centered marketing orientation?",
        options: [
            "The production concept",
            "The marketing concept",
            "The selling concept",
            "The product concept",
            "The societal marketing concept"
        ],
        correct: "The marketing concept"
    },
    {
        question: "To create and capture customer value, companies must engage the first step of the marketing process, which is ________.",
        options: [
            "Construct an integrated marketing program",
            "Understand the marketplace and customer needs and wants",
            "Create customer delight",
            "Build profitable customer relationships",
            "Design a customer value-driven marketing strategy"
        ],
        correct: "Understand the marketplace and customer needs and wants"
    },
    {
        question: "You decided to post your travel pics to Instagram because you wanted to feel connected to your friends. Your drive to post on Instagram is a ________ and your drive to feel connected is a ________.",
        options: [
            "Want; need",
            "Demand; want",
            "Need; want",
            "Demand; need",
            "Need; demand"
        ],
        correct: "Want; need"
    },
    {
        question: "The four Ps of the marketing mix have been redefined in buyer's terms as the four As. Product design influences ________, price affects ________, place affects ________, and promotion influences ________.",
        options: [
            "Awareness; affordability; accessibility; acceptability",
            "Acceptability; affordability; accessibility; awareness",
            "Acceptability; affordability; awareness; accessibility",
            "Acceptability; affordability; awareness; accessibility",
            "Awareness; acceptability; affordability; accessibility"
        ],
        correct: "Acceptability; affordability; awareness; accessibility"
    },
    {
        question: "What are the main components of a marketing plan?",
        options: [
            "A mission statement, objectives, a business portfolio",
            "Segmentation, targeting, positioning",
            "Situation analysis, marketing strategy, implementation plan",
            "Product, price, place, promotion",
            "The marketing budget and a marketing dashboard"
        ],
        correct: "Situation analysis, marketing strategy, implementation plan"
    },
    {
        question: "What is the overall focus of strategic planning?",
        options: [
            "To design a business portfolio",
            "To maximize profits",
            "To ensure prices are lower than competitors",
            "To define the company's mission",
            "To create a game plan for long-run survival and growth in consideration of changing marketing opportunities"
        ],
        correct: "To create a game plan for long-run survival and growth in consideration of changing marketing opportunities"
    },
    {
        question: "The most important actors in the company's microenvironment are ________.",
        options: [
            "Publics",
            "Customers",
            "Suppliers",
            "The company itself",
            "Competitors"
        ],
        correct: "Customers"
    },
    {
        question: "Many companies are going beyond government regulation and are developing strategies and practices that create a world economy that the planet can support indefinitely. This represents:",
        options: [
            "Environmental sustainability",
            "Environmental marketing",
            "Sustained marketing",
            "Pollution control",
            "Green marketing"
        ],
        correct: "Environmental sustainability"
    },
    {
        question: "What are good examples of indirect competitors?",
        options: [
            "iPhone and AirPod",
            "EasyJet and Eurostar",
            "Instagram and Amazon",
            "Nintendo Switch and PlayStation 5",
            "Zara and Mango"
        ],
        correct: "EasyJet and Eurostar"
    },
    {
        question: "Which of the following correctly identifies the five core customer and marketplace concepts?",
        options: [
            "Needs; Wants; Demands; Market offerings; and Markets",
            "Needs, wants, and demands; Market offerings; Value; Satisfaction; and Markets",
            "Needs, wants, and demands; Market offerings; Value and satisfaction; Exchanges and relationships; and Markets",
            "Needs, wants, and demands; Market offerings; Value and satisfaction; Competitors; and Profits",
            "Needs, wants, and demands; Products; Value; Customers; and Competitors"
        ],
        correct: "Needs, wants, and demands; Market offerings; Value and satisfaction; Exchanges and relationships; and Markets"
    }
];

const midterm4Explanations = [
    {
        explanation: "Marketing intermediaries are companies that help deliver products to customers.",
        example: "Wholesalers, resellers, and financial firms that distribute Coca-Cola products."
    },
    {
        explanation: "Indirect customers influence purchases but don't buy directly.",
        example: "Laptop users choosing laptops while unaware of which microchip brand is inside."
    },
    {
        explanation: "Economic downturn = threat, strong encryption = strength.",
        example: "Less consumer spending hurts sales (threat), but Stripe's unique tech keeps them competitive (strength)."
    },
    {
        explanation: "Selling more of current products to existing customers.",
        example: "Starbucks encouraging current customers to buy more coffee."
    },
    {
        explanation: "Competitive situation is part of the microenvironment, not macro.",
        example: "Rival brands competing directly (micro), vs. economic shifts (macro)."
    },
    {
        explanation: "Increased competition pushed companies to focus more on satisfying customers.",
        example: "Many brands competing forces businesses to prioritize customer needs."
    },
    {
        explanation: "People likely to buy from your company in the future, more than competitors.",
        example: "Potential gym clients who prefer your location over others."
    },
    {
        explanation: "Marketing focuses on customers, value, relationships, processes—not competitors directly.",
        example: "Marketing is about delivering value to customers, not beating competitors."
    },
    {
        explanation: "Builds long-term, profitable customer relationships.",
        example: "Apple retains loyal customers by consistently delivering high value."
    },
    {
        explanation: "High-profit industries attract new competitors.",
        example: "New brands entering the profitable smartphone market."
    },
    {
        explanation: "The marketing concept focuses on understanding and responding to customer needs.",
        example: "Netflix analyzing viewer preferences to suggest shows."
    },
    {
        explanation: "Start by understanding customer needs.",
        example: "Surveying students before launching a new study app."
    },
    {
        explanation: "Posting = want, feeling connected = need.",
        example: "Posting vacation photos to feel social belonging."
    },
    {
        explanation: "Product = Acceptability, Price = Affordability, Place = Awareness, Promotion = Accessibility.",
        example: "Affordable smartphone (price), available in many stores (place), with features people want (product)."
    },
    {
        explanation: "Core elements: Product, Price, Place, Promotion.",
        example: "A brand decides what to sell, where, at what price, and how to promote."
    },
    {
        explanation: "Designing the business portfolio for long-term success.",
        example: "A company diversifying products to stay competitive over time."
    },
    {
        explanation: "Customers are central—without them, business fails.",
        example: "All marketing efforts aim to attract and retain customers."
    },
    {
        explanation: "Companies adopting eco-friendly practices beyond laws.",
        example: "IKEA using sustainable materials."
    },
    {
        explanation: "Different products meeting the same need.",
        example: "EasyJet vs. Eurostar—both provide travel options."
    },
    {
        explanation: "Needs, wants, demands; market offerings; value & satisfaction; exchanges & relationships; markets.",
        example: "Customers need transportation, want a car, demand affordable options, exchange money for it, and create a market."
    }
];

let midterm4Submissions = [];

function showMidterm4Test() {
    const content = document.getElementById('course-content');
    content.innerHTML = `
        <div class="quiz-wrapper">
            <h2>Midterm 4</h2>
            <div id="quiz-container">
                ${midterm4Questions.map((q, index) => `
                    <div class="quiz-question">
                        <p><strong>Question ${index + 1}:</strong> ${q.question}</p>
                        <div class="options" style="display: flex; flex-direction: column; gap: 10px;">
                            ${q.options.map(option => `
                                <button class="option-btn" style="width: 100%; text-align: left; padding: 10px;" onclick="selectMidterm4Option(this, ${index})">${option}</button>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
                <div class="nav-container">
                    <button class="nav-btn" onclick="checkAndSubmitMidterm4()">Submit Test</button>
                    <button class="nav-btn secondary" onclick="showMainMenu()">Back to Menu</button>
                </div>
            </div>
        </div>
    `;
}

function selectMidterm4Option(button, questionIndex) {
    // Get all option buttons for this question
    const questionDiv = button.closest('.quiz-question');
    const allOptions = questionDiv.querySelectorAll('.option-btn');
    
    // Remove selected class from all options in this question
    allOptions.forEach(btn => btn.classList.remove('selected'));
    
    // Add selected class to clicked button
    button.classList.add('selected');
}

function checkAndSubmitMidterm4() {
    const questions = document.querySelectorAll('.quiz-question');
    const unansweredCount = Array.from(questions).filter(q => !q.querySelector('.option-btn.selected')).length;
    
    if (unansweredCount > 0) {
        const confirmSubmit = confirm(`Warning: You have ${unansweredCount} unanswered question${unansweredCount > 1 ? 's' : ''}. Do you want to submit anyway?`);
        if (!confirmSubmit) {
            return;
        }
    }
    
    submitMidterm4();
}

function submitMidterm4() {
    // Create an array of all questions with their selected answers
    const questions = document.querySelectorAll('.quiz-question');
    let score = 0;
    const answers = [];
    
    // Go through each question
    questions.forEach((questionDiv, index) => {
        const selectedButton = questionDiv.querySelector('.option-btn.selected');
        const answer = {
            question: midterm4Questions[index].question,
            answer: selectedButton ? selectedButton.textContent : 'Not answered',
            correct: midterm4Questions[index].correct,
            isCorrect: false
        };
        
        // Check if the question was answered and if it's correct
        if (selectedButton) {
            answer.isCorrect = selectedButton.textContent === midterm4Questions[index].correct;
            if (answer.isCorrect) score++;
        }
        
        answers.push(answer);
    });

    // Store the submission
    const submission = {
        date: new Date().toLocaleString(),
        score: score,
        total: midterm4Questions.length,
        answers: answers,
        unansweredCount: answers.filter(a => a.answer === 'Not answered').length
    };

    if (!midterm4Submissions) {
        midterm4Submissions = [];
    }
    midterm4Submissions.unshift(submission);

    showMidterm4Review(0);
}

function showMidterm4Review(submissionIndex) {
    const submission = midterm4Submissions[submissionIndex];
    const content = document.getElementById('course-content');
    
    content.innerHTML = `
        <div class="quiz-wrapper">
            <h2>Midterm 4 Review</h2>
            <div class="review-progress">
                <span>Score:</span>
                <div class="progress-bar">
                    <div class="progress-fill" style="--progress: ${(submission.score / submission.total) * 100}%"></div>
                </div>
                <span>${submission.score}/${submission.total}</span>
            </div>
            <div class="submissions-list">
                ${submission.answers.map((answer, index) => `
                    <div class="review-card ${answer.isCorrect ? 'correct' : 'incorrect'}">
                        <p><strong>Question ${index + 1}:</strong> ${answer.question}</p>
                        <p>Your answer: ${answer.answer}</p>
                        <p>Correct answer: ${answer.correct}</p>
                        ${index < midterm4Explanations.length ? `
                            <div class="flyout-menu">
                                <button class="flyout-button">View Explanation</button>
                                <div class="flyout-content">
                                    <div class="explanation-title">Explanation:</div>
                                    <div class="explanation-text">
                                        ${midterm4Explanations[index].explanation}
                                    </div>
                                    <div class="example-title">Example:</div>
                                    <div class="example-text">
                                        ${midterm4Explanations[index].example}
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `).join('')}
            </div>
            <div class="nav-container">
                <button class="nav-btn" onclick="showMidterm4Submissions()">Back to Submissions</button>
                <button class="nav-btn secondary" onclick="showMainMenu()">Back to Menu</button>
            </div>
        </div>
    `;
}

function showMidterm4Submissions() {
    const content = document.getElementById('course-content');
    const submissions = midterm4Submissions || [];
    
    content.innerHTML = `
        <div class="quiz-wrapper">
            <h2>Midterm 4 Submissions</h2>
            ${submissions.length === 0 ? 
                '<p>No submissions yet.</p>' :
                submissions.map((sub, index) => {
                    const progress = (sub.score / sub.total) * 100;
                    return `
                        <div class="review-card">
                            <div class="review-progress">
                                <span>${sub.score}/${sub.total}</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                                <span>${Math.round(progress)}%</span>
                            </div>
                            <p>${sub.date}</p>
                            <button class="quiz-btn" onclick="showMidterm4Review(${index})">Review Answers</button>
                        </div>
                    `;
                }).join('')
            }
            <div class="nav-container">
                <button class="nav-btn" onclick="showMainMenu()">Back to Menu</button>
            </div>
        </div>
    `;
}
